{% extends 'base.html' %}

{% block content %}
    <h1>Care Journal</h1>

    <!-- Button to trigger the modal -->
    <button class="button is-primary" id="addEntryButton">Add Entry</button>

    <!-- Modal -->
    <div class="modal" id="addEntryModal">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">Add Entry</p>
                <button class="delete" aria-label="close" id="closeModal"></button>
            </header>
            <section class="modal-card-body">
                <!-- Form inputs for care journal entry -->
                <form id="entryForm" method="POST" action="{{ url_for('add_entry', plant_id=plant_id) }}" enctype="multipart/form-data">
                    <div class="field">
                        <label class="label">Date</label>
                        <div class="control">
                            <input class="input" type="date" id="entry_date" name="entry_date" required>
                        </div>
                    </div>
                    
                    <div class="field">
                        <label class="label">Notes</label>
                        <div class="control">
                            <textarea class="textarea" id="notes" name="notes" placeholder="Enter notes" required></textarea>
                        </div>
                    </div>
                    
                    <div class="field">
                        <label class="label">Image Upload</label>
                        <div class="control">
                            <input class="input" type="file" id="image" name="image" accept="image/*">
                        </div>
                    </div>
                </form>
            </section>
            
            <footer class="modal-card-foot">
                <button class="button is-primary" id="submitEntry">Submit</button>
                <button class="button" id="cancelEntry">Cancel</button>
            </footer>
        </div>
    </div>

    <!-- Care Journal Entries Table -->
    <table class="table is-fullwidth is-striped">
        <thead>
            <tr>
                <th>Date</th>
                <th>Notes</th>
                <th>Image</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in care_journal_entries %}
            <tr>
                <td>{{ entry.entry_date.strftime('%Y-%m-%d') }}</td>
                <td>{{ entry.notes }}</td>
                <td>
                    {% if entry.images %}
                        <img src="{{ url_for('static', filename=entry.images[0]) }}" alt="Plant Image" style="width: 100px; height: auto;">
                    {% else %}
                        No Image
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="3">No entries found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        // Modal interaction
        document.getElementById('addEntryButton').addEventListener('click', function() {
            document.getElementById('addEntryModal').classList.add('is-active');
        });
        
        document.getElementById('closeModal').addEventListener('click', function() {
            document.getElementById('addEntryModal').classList.remove('is-active');
        });

        document.getElementById('submitEntry').addEventListener('click', function() {
            document.getElementById('entryForm').submit();
        });

        document.getElementById('cancelEntry').addEventListener('click', function() {
            document.getElementById('addEntryModal').classList.remove('is-active');
        });
    </script>
{% endblock %}
